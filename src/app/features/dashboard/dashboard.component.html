<div class="page-header">
  <h1 class="page-title">Dashboard</h1>
  <p class="page-description">Welcome back, {{ currentUser()?.name || 'User' }}! Here's your project overview.</p>
  
  <!-- Debug info for ViewChild/ViewChildren features -->
  <div class="debug-info" style="font-size: 12px; color: #666; margin-top: 8px;">
    <!-- <span>Stat Cards: {{ totalStatCards }} | Container Visible: {{ isStatsContainerVisible }} | Highlighted: {{ highlightedCardIndex >= 0 ? highlightedCardIndex : 'None' }}</span> -->
  </div>
</div>

<!-- Stats Container with template reference -->
<div #statsContainer class="stats-grid">
  <!-- Stat Cards with template references -->
  <div #statCard class="stat-card" 
       [class.highlighted]="highlightedCardIndex === 0"
       appHighlight="rgba(59, 130, 246, 0.1)" 
       defaultColor="var(--card-bg)"
       (click)="navigateToProjects()"
       (mouseenter)="highlightCard(0)">
    <div class="stat-icon blue">üìÅ</div>
    <div class="stat-content">
      <h3>{{ totalProjects }}</h3>
      <p>Total Projects</p>
    </div>
  </div>
  
  <div #statCard class="stat-card" 
       [class.highlighted]="highlightedCardIndex === 1"
       appHighlight="rgba(249, 115, 22, 0.1)" 
       defaultColor="var(--card-bg)"
       (click)="navigateToTasks('in_progress')"
       (mouseenter)="highlightCard(1)">
    <div class="stat-icon orange">‚ö°</div>
    <div class="stat-content">
      <h3>{{ activeTasks }}</h3>
      <p>Active Tasks</p>
    </div>
  </div>
  
  <div #statCard class="stat-card" 
       [class.highlighted]="highlightedCardIndex === 2"
       appHighlight="rgba(34, 197, 94, 0.1)" 
       defaultColor="var(--card-bg)"
       (click)="navigateToTasks('done')"
       (mouseenter)="highlightCard(2)">
    <div class="stat-icon green">‚úì</div>
    <div class="stat-content">
      <h3>{{ completedTasks }}</h3>
      <p>Completed Tasks</p>
    </div>
  </div>
  
  <div #statCard class="stat-card" 
       [class.highlighted]="highlightedCardIndex === 3"
       appHighlight="rgba(168, 85, 247, 0.1)" 
       defaultColor="var(--card-bg)"
       (click)="navigateToTasks()"
       (mouseenter)="highlightCard(3)">
    <div class="stat-icon purple">üìã</div>
    <div class="stat-content">
      <h3>{{ totalTasks }}</h3>
      <p>Total Tasks</p>
    </div>
  </div>
</div>

<!-- ViewChild Demo Controls -->
<div class="demo-controls" style="margin: 24px 0; padding: 16px; background: var(--card-bg); border-radius: 8px; border: 1px solid var(--color-border);">
  <div style="display: flex; gap: 12px; flex-wrap: wrap;">
    <button class="btn btn--secondary btn--small" (click)="highlightCard(0)">Highlight Projects</button>
    <button class="btn btn--secondary btn--small" (click)="highlightCard(1)">Highlight Active Tasks</button>
    <button class="btn btn--secondary btn--small" (click)="highlightCard(2)">Highlight Completed</button>
    <button class="btn btn--secondary btn--small" (click)="highlightCard(3)">Highlight Total Tasks</button>
    <button class="btn btn--secondary btn--small" (click)="highlightCard(-1)">Clear Highlight</button>
  </div>
</div>

<!-- Recent Activities Section -->
<div class="grid" style="grid-template-columns: 1fr; margin-bottom: 24px;">
  <div class="card">
    <div class="card-header" style="padding: 20px 24px; border-bottom: 1px solid var(--color-border);">
      <h2 style="font-size: 20px; font-weight: 600; margin: 0; color: var(--color-text);">Recent Activities</h2>
    </div>
    <div class="card-body" style="padding: 24px;">
      <div class="activity-list">
        @for (task of recentTasks; track task.id) {
          <div class="activity-item" style="display: flex; align-items: flex-start; gap: 16px; padding: 16px; border-radius: 8px; transition: background-color 0.2s ease; border: 1px solid var(--color-border); margin-bottom: 12px;">
            <div class="activity-icon" style="width: 40px; height: 40px; border-radius: 8px; background: var(--color-secondary); display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0;">
              üìù
            </div>
            <div class="activity-content" style="flex: 1; display: flex; flex-direction: column; gap: 8px;">
              <h3 style="font-size: 16px; font-weight: 600; margin: 0; color: var(--color-text);">
                {{ task.title }}
              </h3>
              <p style="font-size: 14px; margin: 0; color: var(--color-text-secondary); line-height: 1.5;">
                {{ task.description }}
              </p>
              <div style="display: flex; gap: 24px; margin-top: 4px;">
                <div style="display: flex; flex-direction: column; gap: 4px;">
                  <span style="font-size: 12px; color: var(--color-text-secondary);">Due Date</span>
                  <span style="font-size: 14px; font-weight: 500; color: var(--color-text);">
                    {{ task.dueDate | date:'mediumDate' }}
                  </span>
                </div>
                <div style="display: flex; flex-direction: column; gap: 4px;">
                  <span style="font-size: 12px; color: var(--color-text-secondary);">Created</span>
                  <span style="font-size: 14px; font-weight: 500; color: var(--color-text);">
                    {{ task.createdAt | date:'mediumDate' }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions and Task Summary Section -->
<div class="grid grid-2" style="gap: 24px; margin-top: 24px;">
  <!-- Quick Actions Card -->
  <div class="card">
    <div class="card-header" style="padding: 20px 24px; border-bottom: 1px solid var(--color-border);">
      <h2 style="font-size: 20px; font-weight: 600; margin: 0; color: var(--color-text);">Quick Actions</h2>
    </div>
    <div class="card-body" style="padding: 24px;">
      <div class="flex flex-col" style="gap: 16px;">
        <button class="btn btn--primary w-full" (click)="openCreateProjectDialog()">+ Create New Project</button>
        <button class="btn btn--secondary w-full" (click)="openCreateTaskDialog()">+ Add New Task</button>
        <button class="btn btn--secondary w-full" (click)="navigate('/team')">View Team Members</button>
      </div>
    </div>
  </div>
  
  <!-- Task Summary Card -->
  <div class="card">
    <div class="card-header" style="padding: 20px 24px; border-bottom: 1px solid var(--color-border);">
      <h2 style="font-size: 20px; font-weight: 600; margin: 0; color: var(--color-text);">Task Summary</h2>
    </div>
    <div class="card-body" style="padding: 24px;">
      <div class="flex flex-col" style="gap: 24px;">
        <div style="display: flex; flex-direction: column; gap: 16px;">
          <div class="flex justify-between" style="align-items: center;">
            <span style="font-size: 16px; color: var(--color-text);">Todo</span>
            <span class="badge badge--todo" style="padding: 6px 12px; border-radius: 12px; font-size: 14px; font-weight: 500;">{{ todoTasks }}</span>
          </div>
          <div class="flex justify-between" style="align-items: center;">
            <span style="font-size: 16px; color: var(--color-text);">In Progress</span>
            <span class="badge badge--in_progress" style="padding: 6px 12px; border-radius: 12px; font-size: 14px; font-weight: 500;">{{ activeTasks }}</span>
          </div>
          <div class="flex justify-between" style="align-items: center;">
            <span style="font-size: 16px; color: var(--color-text);">Completed</span>
            <span class="badge badge--done" style="padding: 6px 12px; border-radius: 12px; font-size: 14px; font-weight: 500;">{{ completedTasks }}</span>
          </div>
        </div>
        
        <!-- ViewChildren Info -->
        <div class="viewchildren-info" style="padding: 16px; background: var(--color-secondary); border-radius: 8px; border: 1px solid var(--color-border);">
          <div style="font-size: 14px; color: var(--color-text-secondary);">
            <div style="margin-bottom: 4px; font-weight: 500;">Stats Container Info</div>
            <div style="font-size: 12px;">Total Cards: {{ totalStatCards }}</div>
            <!-- <div>Container Visible: {{ isStatsContainerVisible ? 'Yes' : 'No' }}</div> -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Create Project Dialog -->
@if (showCreateProjectDialog) {
<div class="dialog-overlay">
  <div class="dialog">
    <div class="dialog-header">
      <h2 class="dialog-title">Create New Project</h2>
      <button class="dialog-close" (click)="closeCreateProjectDialog()">√ó</button>
    </div>
    
    <div class="dialog-body">
      <form [formGroup]="projectForm" class="form">
        <div class="form-group">
          <label for="projectName" class="form-label">Project Name</label>
          <input
            type="text"
            id="projectName"
            formControlName="name"
            class="form-input"
            placeholder="Enter project name"
            #projectNameInput
          />
          @if (projectForm.get('name')?.invalid && projectForm.get('name')?.touched) {
            <div class="form-error">
              Project name is required and must be at least 3 characters long.
            </div>
          }
        </div>

        <div class="form-group">
          <label for="projectDescription" class="form-label">Description</label>
          <textarea
            id="projectDescription"
            formControlName="description"
            class="form-textarea"
            placeholder="Enter project description"
            rows="3"
          ></textarea>
          @if (projectForm.get('description')?.invalid && projectForm.get('description')?.touched) {
            <div class="form-error">
              Description is required and must be at least 10 characters long.
            </div>
          }
        </div>

        <div class="form-group">
          <label for="projectStatus" class="form-label">Status</label>
          <select
            id="projectStatus"
            formControlName="status"
            class="form-select"
          >
            <option value="planning">Planning</option>
            <option value="in_progress">In Progress</option>
            <option value="on_hold">On Hold</option>
            <option value="completed">Completed</option>
          </select>
        </div>

        <div class="form-group">
          <label for="projectStartDate" class="form-label">Start Date</label>
          <input
            type="date"
            id="projectStartDate"
            formControlName="startDate"
            class="form-input"
          />
          @if (projectForm.get('startDate')?.invalid && projectForm.get('startDate')?.touched) {
            <div class="form-error">
              Start date is required.
            </div>
          }
        </div>
      </form>
    </div>
    
    <div class="dialog-footer">
      <button class="btn btn--secondary" (click)="closeCreateProjectDialog()">Cancel</button>
      <button 
        class="btn btn--primary" 
        (click)="createProject()"
        [disabled]="!projectForm.valid"
      >
        Create Project
      </button>
    </div>
  </div>
</div>
}

<!-- Create Task Dialog -->
@if (showCreateTaskDialog) {
<div class="dialog-overlay">
  <div class="dialog">
    <div class="dialog-header">
      <h2 class="dialog-title">Create New Task</h2>
      <button class="dialog-close" (click)="closeCreateTaskDialog()">√ó</button>
    </div>
    
    <div class="dialog-body">
      <form [formGroup]="taskForm" class="form">
        <div class="form-group">
          <label for="taskTitle" class="form-label">Task Title</label>
          <input
            type="text"
            id="taskTitle"
            formControlName="title"
            class="form-input"
            placeholder="Enter task title"
            #taskTitleInput
          />
          @if (taskForm.get('title')?.invalid && taskForm.get('title')?.touched) {
            <div class="form-error">
              Task title is required and must be at least 3 characters long.
            </div>
          }
        </div>

        <div class="form-group">
          <label for="taskDescription" class="form-label">Description</label>
          <textarea
            id="taskDescription"
            formControlName="description"
            class="form-textarea"
            placeholder="Enter task description"
            rows="3"
          ></textarea>
          @if (taskForm.get('description')?.invalid && taskForm.get('description')?.touched) {
            <div class="form-error">
              Description is required and must be at least 10 characters long.
            </div>
          }
        </div>

        <div class="form-group">
          <label for="taskProject" class="form-label">Project</label>
          <select
            id="taskProject"
            formControlName="projectId"
            class="form-select"
          >
            <option value="">Select a project</option>
            @for (project of projects(); track project.id) {
              <option [value]="project.id">{{ project.name }}</option>
            }
          </select>
          @if (taskForm.get('projectId')?.invalid && taskForm.get('projectId')?.touched) {
            <div class="form-error">
              Project is required.
            </div>
          }
        </div>

        <div class="form-group">
          <label for="taskStatus" class="form-label">Status</label>
          <select
            id="taskStatus"
            formControlName="status"
            class="form-select"
          >
            <option value="todo">Todo</option>
            <option value="in_progress">In Progress</option>
            <option value="done">Done</option>
          </select>
        </div>

        <div class="form-group">
          <label for="taskPriority" class="form-label">Priority</label>
          <select
            id="taskPriority"
            formControlName="priority"
            class="form-select"
          >
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
          </select>
        </div>

        <div class="form-group">
          <label for="taskDueDate" class="form-label">Due Date</label>
          <input
            type="date"
            id="taskDueDate"
            formControlName="dueDate"
            class="form-input"
          />
          @if (taskForm.get('dueDate')?.invalid && taskForm.get('dueDate')?.touched) {
            <div class="form-error">
              Due date is required.
            </div>
          }
        </div>

        <div class="form-group">
          <label for="taskAssignedTo" class="form-label">Assign To</label>
          <select
            id="taskAssignedTo"
            formControlName="assignedTo"
            class="form-select"
          >
            <option value="">Select a team member</option>
            @for (user of users(); track user.id) {
              <option [value]="user.id">{{ user.name }}</option>
            }
          </select>
          @if (taskForm.get('assignedTo')?.invalid && taskForm.get('assignedTo')?.touched) {
            <div class="form-error">
              Assigning to a team member is required.
            </div>
          }
        </div>
      </form>
    </div>
    
    <div class="dialog-footer">
      <button class="btn btn--secondary" (click)="closeCreateTaskDialog()">Cancel</button>
      <button 
        class="btn btn--primary" 
        (click)="createTask()"
        [disabled]="!taskForm.valid"
      >
        Create Task
      </button>
    </div>
  </div>
</div>
}