<!-- src/app/shared/components/layout/layout.component.html -->
<div class="app-layout">
  <aside class="sidebar" [class.collapsed]="sidebarCollapsed">
    <div class="sidebar-header">
      <div class="sidebar-logo">üöÄ Task Project</div>
    </div>
    <nav class="sidebar-nav">
      <a routerLink="/dashboard" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">üìä</span>
        <span>Dashboard</span>
      </a>
      <a routerLink="/projects" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">üìÅ</span>
        <span>Projects</span>
      </a>
      <a routerLink="/tasks" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">‚úì</span>
        <span>Tasks</span>
      </a>
      <a routerLink="/team" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">üë•</span>
        <span>Team</span>
      </a>
      <a routerLink="/profile" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">üë§</span>
        <span>Profile</span>
      </a>
      <a href="#" class="nav-item" (click)="onLogout($event)">
        <span class="nav-icon">üö™</span>
        <span>Logout</span>
      </a>
    </nav>
  </aside>
  
  <div class="main-content">
    <header class="app-header">
      <div class="header-left">
        <button class="menu-toggle" (click)="toggleSidebar()">‚ò∞</button>
        
        <!-- Enhanced Search Bar with Results -->
        <div class="search-container" *ngIf="showSearchBar()">
          <div class="search-bar">
            <span class="search-icon">üîç</span>
            <input 
              #searchInput
              type="text" 
              [placeholder]="searchPlaceholder"
              (input)="onSearchInput($event)"
              (keydown)="onSearchKeyPress($event)"
            />
            
            <!-- Loading Indicator -->
            @if (isSearching()) {
              <span class="search-loading">‚è≥</span>
            }
          </div>
          
          <!-- Search Results Dropdown -->
          @if (showSearchResults() && searchResults().length > 0) {
            <div class="search-results-dropdown">
              <div class="search-results-header">
                <span>Found {{ searchResults().length }} results</span>
                <button class="close-btn" (click)="closeSearchResults()">‚úï</button>
              </div>
              
              <div class="search-results-list">
                @for (result of searchResults(); track result.id) {
                  <div class="search-result-item" (click)="selectSearchResult(result)">
                    <div class="result-main">
                      <div class="result-title">{{ result.title }}</div>
                      <div class="result-description">{{ result.description }}</div>
                      <div class="result-project">Project: {{ result.project_name }}</div>
                    </div>
                    <div class="result-badges">
                      <span class="badge" [class]="getPriorityClass(result.priority)">
                        {{ result.priority }}
                      </span>
                      <span class="badge" [class]="getStatusClass(result.status)">
                        {{ result.status }}
                      </span>
                    </div>
                  </div>
                }
              </div>
              
              <div class="search-results-footer">
                <span style="font-size: 11px; color: #666;">Press Enter to select first result, Esc to close</span>
              </div>
            </div>
          }
        </div>
      </div>
      
      <div class="header-right">
        <div class="user-menu">
          <div class="user-avatar">{{ currentUser()?.avatar || 'üë§' }}</div>
        </div>
      </div>
    </header>
    
    <div class="content-area">
      <router-outlet></router-outlet>
    </div>
  </div>
</div>

<style>
  /* Search Container */
  .search-container {
    position: relative;
    width: 400px;
  }

  .search-loading {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 14px;
  }

  /* Search Results Dropdown */
  .search-results-dropdown {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    right: 0;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    max-height: 400px;
    display: flex;
    flex-direction: column;
    z-index: 1000;
  }

  .search-results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    border-bottom: 1px solid var(--color-border);
    font-size: 13px;
    font-weight: 600;
    color: var(--color-text-secondary);
  }

  .close-btn {
    background: none;
    border: none;
    font-size: 18px;
    cursor: pointer;
    color: var(--color-text-secondary);
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
  }

  .close-btn:hover {
    background: var(--color-secondary);
  }

  .search-results-list {
    overflow-y: auto;
    max-height: 320px;
  }

  .search-result-item {
    padding: 12px 16px;
    border-bottom: 1px solid var(--color-border);
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: start;
    gap: 12px;
    transition: background-color 0.2s;
  }

  .search-result-item:hover {
    background-color: var(--color-secondary);
  }

  .search-result-item:last-child {
    border-bottom: none;
  }

  .result-main {
    flex: 1;
    min-width: 0;
  }

  .result-title {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 4px;
    color: var(--color-text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .result-description {
    font-size: 12px;
    color: var(--color-text-secondary);
    margin-bottom: 4px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .result-project {
    font-size: 11px;
    color: var(--color-text-secondary);
    font-style: italic;
  }

  .result-badges {
    display: flex;
    flex-direction: column;
    gap: 4px;
    flex-shrink: 0;
  }

  .search-results-footer {
    padding: 8px 16px;
    border-top: 1px solid var(--color-border);
    background: var(--color-background);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .search-container {
      width: 100%;
      max-width: 300px;
    }
  }
</style>